{% extends "base.html.jinja" %}
{% block css_block %}
<link href="{{ static_base }}/static/css/gmaps.css" rel="stylesheet">
{% endblock %}

{% block js_block %}
<script src="{{ static_base }}/static/js/course_view.js"></script>
{% endblock %}

{% block body %}
<!-- <h2>Distance: {{ distance }}</h2> -->
<!-- <h3>Time guess: {{ duration }}</h3> -->
<h2>Route ID: {{ route.route_id }}</h2>
<h3>Course ID: <a href="{{base_path}}/course/view?course_id={{ route.course_id }}">{{ route.course_id }}</a></h3>
<hr/>
<table class="table table-striped table-bordered">
  <tbody>
    <tr>
      <td>Route distance (m)</td>
      <td>{{route.route["distance"]["value"]}}</td>
    </tr>
    <tr>
      <td>Straight-line (m)</td>
      <td>{{route.route["distance"]["crow"]}}</td>
    </tr>
    <tr>
      <td>Waste (m)</td>
      <td>{{route.route["distance"]["waste_meters"]}}</td>
    </tr>
    <tr>
      <td>Waste (%)</td>
      <td>{{route.route["distance"]["waste_percent"]*100}}</td>
    </tr>
  </tbody>
</table>

<hr/>

<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th scope="col">Start</th>
      <th scope="col">End</th>
      <th scope="col">Leg distance (m)</th>
      <th scope="col">Straight-line (m)</th>
      <th scope="col">Waste (m)</th>
      <th scope="col">Waste (%)</th>
    </tr>
  </thead>
  <tbody>
    {% for leg in route.route["legs"] %}
    <tr>
      <td>{{leg["start_address"]}}</td>
      <td>{{leg["end_address"]}}</td>
      <td>{{leg["distance"]["value"]}}</td>
      <td>{{leg["distance"]["crow"]}}</td>
      <td>{{leg["distance"]["waste_meters"]}}</td>
      <td>{{leg["distance"]["waste_percent"]*100}}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- https://developers.google.com/maps/documentation/javascript/tutorial -->
<div class="map" id="map"></div>
<div class="directions" id="directions"></div>
<script>
  var map;
  function initMap() {
    var directionsService = new google.maps.DirectionsService();
    var directionsDisplay = new google.maps.DirectionsRenderer();
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: {{course.gps_center["lat"]}}, lng: {{course.gps_center["lng"]}}},
      zoom: 8
    });
    directionsDisplay.setMap(map);
    directionsDisplay.setPanel(document.getElementById('directions'));
    {% if js_data %}
    directionsDisplay.setDirections({{js_data}});
    {% endif %}
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ GMAPS_API_KEY }}&callback=initMap" async defer></script>

{% endblock %}
